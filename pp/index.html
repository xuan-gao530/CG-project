<!DOCTYPE html>
<html>

<head>
    <style>
        header {
            color:#330099;
            text-align:center;
            padding:10px;
        }
        body{
            background-image:url("./order05.jpg");
            background-size:cover;
        }
        section {
            color:#330099;
            text-align:center;
            padding:10px;
        }
    </style>
    <style>

        canvas {
            position: absolute;z-index:-2;
            top: 400px;
            left: 200px;
            background-color: White;
        }
    </style>

    <!--
      CanvasMatrix class
      (c) Apple Inc
      -->
    <script src="CanvasMatrix.js" type="text/javascript"></script>

    <!--
      Vertex shader
      -->
    <script id="shader-vs" type="x-shader/x-vertex">
precision highp float;
uniform   float time;  //  Time
attribute vec3 XYZ;
attribute vec3 RGB;
attribute float Startime; //  Start time
attribute vec3  Velocity;   //  Velocity

uniform mat4 ProjectionMatrix;
uniform mat4 ModelviewMatrix;
varying vec3 col;

void main(void)
{
  vec4 vert = vec4(XYZ,1.0);
  gl_PointSize = 1.0;
  float t =mod(time,6.0)-Startime;
if(t<0.0)
{
   col = vec3(1.0,1.0,1.0);
}
else
{
   col = RGB;
   vert+=t*vec4(Velocity,0.0);
   vert.y-=9.81*t*t;
    if(vert.y<-2.0)
      {
        col = vec3(1.0,1.0,1.0);
      }

}
gl_Position= ProjectionMatrix * ModelviewMatrix * vert;
}

</script>

    <!--
      Fragment shader
      -->
    <script id="shader-fs" type="x-shader/x-fragment">
precision highp float;
varying vec3 col;
void main(void)
{
   gl_FragColor = vec4(col,1.0);
}
</script>

    <!--
      WebGL program
      -->
    <script type="text/javascript">

        //
        //  Compile a shader
        //
        function CompileShader(gl,id)
        {
            //  Get shader by id
            var src = document.getElementById(id);
            //  Create shader based on type setting
            var shader;
            if (src.type == "x-shader/x-fragment")
                shader = gl.createShader(gl.FRAGMENT_SHADER);
            else if (src.type == "x-shader/x-vertex")
                shader = gl.createShader(gl.VERTEX_SHADER);
            else
                return null;
            //  Read source into str
            var str = "";
            var k = src.firstChild;
            while (k)
            {
                if (k.nodeType == 3) str += k.textContent;
                k = k.nextSibling;
            }
            gl.shaderSource(shader, str);
            //  Compile the shader
            gl.compileShader(shader);
            //  Check for errors
            if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) == 0)
                alert(gl.getShaderInfoLog(shader));
            //  Return shader
            return shader;
        }

        //
        //  Compile shader program
        //
        function CompileShaderProg(gl,vert,frag)
        {
            //  Compile the program
            var prog  = gl.createProgram();
            gl.attachShader(prog , CompileShader(gl,vert));
            gl.attachShader(prog , CompileShader(gl,frag));
            gl.linkProgram(prog);
            //  Check for errors
            if (gl.getProgramParameter(prog, gl.LINK_STATUS) == 0)
                alert(gl.getProgramInfoLog(prog));
            //  Return program
            return prog;
        }

        function frand(x,y)
        {
            var r = Math.random()*x+y;
            return r;
        }





        var gl,canvas;
        function webGLStart()
        {
            //  Set canvas
            canvas = document.getElementById("canvas");
            //  Select canvas size
            var size = Math.min(window.innerWidth,window.innerHeight)-10;
            canvas.width  = window.innerWidth-200;
            canvas.height = 90;
            if (!window.WebGLRenderingContext)
            {
                alert("Your browser does not support WebGL. See http://get.webgl.org");
                return;
            }
            try
            {
                gl = canvas.getContext("experimental-webgl");
            }
            catch(e)
            {}
            if (!gl)
            {
                alert("Can't get WebGL");
                return;
            }
            gl.viewport(0,0,canvas.width,canvas.height);
            var prog = CompileShaderProg(gl,"shader-vs","shader-fs");
            gl.useProgram(prog);
            var ProjectionMatrix = new CanvasMatrix4();
            ProjectionMatrix.ortho(-2.5,+2.5,-2.5,+2.5,-2.5,+2.5);
            var N = 100;
            var Vert  = new Array();//3*N*N
            var Color = new Array();//3*N*N
            var Vel   = new Array();//3*N*N
            var Start = new Array();//N*N

            InitPart();
            function InitPart()
            {
                var x1 =0;
                var z1 =0;
                var radius =1.0;
                for (var i=0;i<N*N;i=i+1)
                {
                    var r1 = frand(2.0,-1.0);     //(-1,1)
                    var r2 = frand(2.0,-1.0);     //(-1,1)
                    //  Location x,y,z
                    x1 = frand(2.0,-1.0)*radius;
                    z1 = frand(2.0,-1.0)*radius;
                    while(Math.sqrt(x1*x1+z1*z1)>1)
                    {
                        x1 =frand(2.0,-1.0);
                        z1 =frand(2.0,-1.0);
                    }
                    Vert.push(x1)
                    Vert.push(-2.0);
                    Vert.push(z1);

                    //  Color r,g,b
                    Color.push(frand(0.5,0.0));
                    Color.push(frand(0.5,0.5));
                    Color.push(frand(0.6,0.8));
                    //  Velocity
                    var dist = Math.sqrt(Math.pow(x1,2.0)+Math.pow(z1,2));
                    Vel.push(Math.sin(Math.PI/3*r1)*Math.cos(Math.PI*r2));
                    Vel.push(12.0*(1-Math.pow(dist,2)));
                    Vel.push(Math.sin(Math.PI/3*r1)*Math.sin(Math.PI*r2));
                    //  Launch
                    Start.push(frand(3.0,0.0));
                }
            }

            var verts = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER,verts);
            gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Vert),gl.STATIC_DRAW);

            var color = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER,color);
            gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Color),gl.STATIC_DRAW);

            var vel = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER,vel);
            gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Vel),gl.STATIC_DRAW);

            var start = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER,start);
            gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(Start),gl.STATIC_DRAW);

            // paint
            gl.enable(gl.DEPTH_TEST);
            gl.clearColor(1.0,1.0,1.0,1);
            var th = ph = 15;

            DrawPart();
            requestAnimationFrame(DrawPart);
            function DrawPart(time)
            {
                time *= 0.001;
                //Clear the screen and Z buffer
                gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);
                // Compute modelview matrix
                var ModelviewMatrix = new CanvasMatrix4();
                ModelviewMatrix.makeIdentity();
                ModelviewMatrix.rotate(ph,0,1,0);
                ModelviewMatrix.rotate(th,1,0,0);

                // Set shader
                gl.useProgram(prog);
                // Set projection and modelview matrixes
                gl.uniformMatrix4fv(gl.getUniformLocation(prog,"ProjectionMatrix") , false , new Float32Array(ProjectionMatrix.getAsArray()));
                gl.uniformMatrix4fv(gl.getUniformLocation(prog,"ModelviewMatrix")  , false , new Float32Array(ModelviewMatrix.getAsArray()));

                //  Set up 3D vertex array
                gl.bindBuffer(gl.ARRAY_BUFFER,verts);
                var XYZ = gl.getAttribLocation(prog,"XYZ");
                gl.enableVertexAttribArray(XYZ);
                gl.vertexAttribPointer(XYZ,3,gl.FLOAT,false,0,0);

                //  Set up 3D color array
                gl.bindBuffer(gl.ARRAY_BUFFER,color);
                var RGB = gl.getAttribLocation(prog,"RGB");
                gl.enableVertexAttribArray(RGB);
                gl.vertexAttribPointer(RGB,3,gl.FLOAT,false,0,0);

                gl.bindBuffer(gl.ARRAY_BUFFER,vel);
                var Velocity = gl.getAttribLocation(prog,"Velocity");
                gl.enableVertexAttribArray(Velocity);
                gl.vertexAttribPointer(Velocity,3,gl.FLOAT,false,0,0);

                gl.bindBuffer(gl.ARRAY_BUFFER,start);
                var Startime = gl.getAttribLocation(prog,"Startime");
                gl.enableVertexAttribArray(Startime);
                gl.vertexAttribPointer(Startime,3,gl.FLOAT,false,0,0);


                const numCubes = 12;
                for (let i = 0; i <= numCubes; ++i) {
                    time = time +1.0;
                    var ModelviewMatrix = new CanvasMatrix4();
                    ModelviewMatrix.makeIdentity();
                    ModelviewMatrix.translate(-12.0 + i*4.0, 0, 0);
                    ModelviewMatrix.scale(0.1,1.2,0.1);
                    gl.uniformMatrix4fv(gl.getUniformLocation(prog,"ModelviewMatrix")  , false , new Float32Array(ModelviewMatrix.getAsArray()));
                    gl.uniform1f(gl.getUniformLocation(prog,"time"),time);
                    gl.drawArrays(gl.POINTS,0,N*N);
                }


                //  Disable vertex arrays
                gl.disableVertexAttribArray(XYZ);
                gl.disableVertexAttribArray(RGB);
                gl.disableVertexAttribArray(Velocity);
                gl.disableVertexAttribArray(Startime);
                requestAnimationFrame(DrawPart);
                //  Flush
                gl.flush ();
            }
        }

    </script>

</head>

<body onload="webGLStart()">
<canvas id="canvas" width=“500” height="100"></canvas>
<header>
    <h1 style="font-size:50px">Sunny Supermarket</h1>
</header>

<section>
    <div id ="main" style="width:1200px;">
        <div id ="left" style="width:600px;float:left;">
            <input type="button" value="Login" onclick="window.open('login.jsp')" style="color:#330099;font-size:20px;background-color: transparent; border: 0;">
        </div>
        <div id="right"style="width:600px;float:left;">
            <form action="SearchServlet" mehtod="post">
                <input type ="submit" name="guest" value="continue as a guest" style="color:#330099;font-size:20px;background-color:transparent;border:0;">
            </form>
        </div>
    </div>
</section>

</body>
</html>
